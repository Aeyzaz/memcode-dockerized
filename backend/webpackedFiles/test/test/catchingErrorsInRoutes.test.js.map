{"version":3,"sources":["webpack:///webpack/bootstrap 739628366e8a6c91c489?d06b****","webpack:///external \"express\"?d2d2*","webpack:///./middlewares/handleErrors.js?2f3b*","webpack:///./services/catchAsync.js?f37a*","webpack:///external \"pretty-error\"?dc74*","webpack:///external \"supertest\"?259b","webpack:///./test/catchingErrorsInRoutes.test.js","webpack:///external \"chai\"?e564**"],"names":["prettyError","skipPackage","skipPath","skipNodeFiles","alias","appendStyle","color","background","marginLeft","handleErrors","error","request","response","next","process","env","NODE_ENV","renderedError","render","console","log","status","json","message","catchAsync","asyncFunction","promise","catch","createAppWithRoute","routeCallback","app","testRouter","Router","get","use","describe","it","done","hm","expect","end","body","to","deep","equal","Error","Promise","reject"],"mappings":"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","file":"test/test/catchingErrorsInRoutes.test.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// identity function for calling harmony imports with the correct context\n \t__webpack_require__.i = function(value) { return value; };\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 76);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 739628366e8a6c91c489","module.exports = require(\"express\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"express\"\n// module id = 2\n// module chunks = 0 1 5","// eslint-disable-next-line import/no-extraneous-dependencies\nimport PrettyError from 'pretty-error';\nconst prettyError = new PrettyError();\n\nprettyError.skipPackage('express', 'babel-polyfill', 'regenerator-runtime');\nprettyError.skipPath('internal/process/next_tick.js');\nprettyError.skipNodeFiles();\nprettyError.alias('/Users/lakesare/Desktop/memcode/backend/webpacked/test/components/auth/routes/webpack:', '');\nprettyError.alias('/Users/lakesare/Desktop/memcode/backend/webpacked/test', '');\nprettyError.appendStyle({\n  // our error message\n  'pretty-error > header > message': {\n    // let's change its color:\n    color: 'bright-white',\n    // we can also change the background color:\n    background: 'black'\n  },\n\n  // each trace item ...\n  'pretty-error > trace > item': {\n    // ... can have a margin ...\n    marginLeft: 20\n  },\n\n  'pretty-error > trace > item > header > pointer > file': {\n    color: 'blue'\n  },\n\n  'pretty-error > trace > item > header > pointer > colon': {\n    color: 'cyan'\n  },\n\n  'pretty-error > trace > item > header > pointer > line': {\n    color: 'black'\n  },\n\n  'pretty-error > trace > item > header > what': {\n    color: 'bright-white'\n  }\n});\n\n// because express needs to see there are 4 arguments to treat :error as error.\n// this middleware should also come last.\n// eslint-disable-next-line no-unused-vars\nconst handleErrors = (error, request, response, next) => {\n  if (process.env.NODE_ENV !== 'test') {\n    const renderedError = prettyError.render(error);\n    console.log(renderedError);\n  }\n\n  // interestingly if error.message is undefined, express will return {}\n  // it must _always_ be a string. I'm not sure if it is.\n  response.status(500).json({ error: error.message || error || '' });\n};\n\nexport { handleErrors };\n\n\n\n// WEBPACK FOOTER //\n// ./middlewares/handleErrors.js","// catch Async Await function's error\n//\n// catchAsync can only accept async functions, because otherwise .catch is undefined.\n// (or they need to return a promise, but that's not the case with express endpoints)\nconst catchAsync = (asyncFunction) =>\n  (request, response, next) => {\n    const promise = asyncFunction(request, response, next);\n    promise\n      .catch((error) => {\n        next(error);\n      });\n  };\n\nexport { catchAsync };\n\n\n\n// WEBPACK FOOTER //\n// ./services/catchAsync.js","module.exports = require(\"pretty-error\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"pretty-error\"\n// module id = 38\n// module chunks = 0 1 5","module.exports = require(\"supertest\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"supertest\"\n// module id = 40\n// module chunks = 1 5","import { expect } from 'chai';\nimport supertest from 'supertest';\nimport express from 'express';\nimport { catchAsync } from '~/services/catchAsync';\nimport { handleErrors } from '~/middlewares/handleErrors';\n\n\nconst createAppWithRoute = (routeCallback) => {\n  const app = express();\n  const testRouter = express.Router();\n  testRouter.get('/hello', routeCallback);\n\n  app.use('/test', testRouter);\n  app.use(handleErrors);\n\n  return app;\n};\n\ndescribe('catchingErrorsInRoutes', () => {\n  it('no errors => returns status and json as per route definition', (done) => {\n    const app = createAppWithRoute(\n      catchAsync(async (request, response) => {\n        response.status(234).json({ hm: 'yes' });\n      })\n    );\n\n    supertest(app)\n      .get('/test/hello')\n      .expect(234)\n      .end((error, response) => {\n        expect(response.body).to.deep.equal({ hm: 'yes' });\n        error ? done(error) : done();\n      });\n  });\n\n  it('sync error without catchAsync', (done) => {\n    const app = createAppWithRoute(\n      () => {\n        throw new Error('Rrr!');\n      }\n    );\n\n    supertest(app)\n      .get('/test/hello')\n      .expect(500, { error: 'Rrr!' }, done);\n  });\n\n  it('sync error with catchAsync', (done) => {\n    const app = createAppWithRoute(\n      catchAsync(async () => {\n        throw new Error('Rrr!');\n      })\n    );\n\n    supertest(app)\n      .get('/test/hello')\n      .expect(500, { error: 'Rrr!' }, done);\n  });\n\n  // ___didn't include because couldn't catch Unhandled promise rejection (rejection id: 2): Rrr!\n  // it('async error without catchAsync', (done) => {})\n\n  it('async error with catchAsync', (done) => {\n    const app = createAppWithRoute(\n      catchAsync(async () => {\n        await Promise.reject('Sss!');\n      })\n    );\n\n    supertest(app)\n      .get('/test/hello')\n      .expect(500, { error: 'Sss!' }, done);\n  });\n});\n\n\n\n// WEBPACK FOOTER //\n// ./test/catchingErrorsInRoutes.test.js","module.exports = require(\"chai\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"chai\"\n// module id = 8\n// module chunks = 1 2 3 5 6"],"sourceRoot":""}